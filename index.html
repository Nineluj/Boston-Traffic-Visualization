<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">
        <title>Boston Traffic Visulization</title>
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script src="csvhelper.js" type="text/javascript"></script>
        <script src="script.js" type="text/javascript"></script>
        <script src="TrafficScript/station_counts.js" type="text/javascript"></script>
        <script>
            $.getScript("key.js").done(function () {
                $.getScript("https://maps.googleapis.com/maps/api/js?key=" + GOOGLE_API_KEY + "&callback=initMap");
            }).fail(function () {
                GOOGLE_API_KEY = "AIzaSyBjwtHa2pv3s7cE5GpROOF5zikYLbRWyC8";
                $.getScript("https://maps.googleapis.com/maps/api/js?key=" + GOOGLE_API_KEY + "&callback=initMap");
            });
        </script>
        <style>
            ul {
                list-style-type: none;
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #333;
            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
            li {
                float: left;
            }

            li a {
                display: inline-block;
                color: white;
                text-align: center;
                padding: 14px 16px;
                text-decoration: none;
            }

            li a:hover {
                background-color: #111;
            }
            /* Always set the map height explicitly to define the size of the div
             * element that contains the map. */
            #map {
                height: 100%;
            }
            #header{
                height: 19px;
                position: absolute;
                z-index: 150;
                width: 100%;
            }
            /* Optional: Makes the sample page fill the window. */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
            
            #overlay {
                font-family: sans-serif;
                background: grey;
                padding: 5px;;
                width: 130px;
                z-index: 100;
                position: fixed;
                margin-top: 55px;
            }

            #overlay a, 
            #overlay h3 {
                font-size: 0.9em;
                display: block;
                margin: 0 0.5em;
                color: white;
            }
        </style>
    </head>
    <body>
        <div id="header">
            <ul>
                <li><a href="index.html">Visulization</a></li>
                <li><a href="">Analysis</a></li>
                <li><a href="">CSV</a></li>
            </ul>
        </div>
        <div id="overlay">
            Check for 
            <form action="index.html" method="get">
                <input type="checkbox" name="Graph Congestion" value="true" checked /><br>
                <input type="submit" value="Refresh">
            </form>
        </div>
        <div id="map"></div>
        <script async defer>
            var imgacc = "https://raw.githubusercontent.com/TheGuy191919/Boston-Traffic-Visualization/master/Icon/accident.png";
            var imgpot = "https://raw.githubusercontent.com/TheGuy191919/Boston-Traffic-Visualization/master/Icon/pothole.png";
            var imghaz = "https://raw.githubusercontent.com/TheGuy191919/Boston-Traffic-Visualization/master/Icon/hazard.png";
            var imgclo = "https://raw.githubusercontent.com/TheGuy191919/Boston-Traffic-Visualization/master/Icon/closed.png";
            var imgcon = "https://raw.githubusercontent.com/TheGuy191919/Boston-Traffic-Visualization/master/Icon/construction.png";

            var map = {};

            function renderTraffic(){
                // Congestion data
                var citymap = station_flattened;
                for (var station in station_flattened) {
                    // Add the circle for this city to the map.
                    var cityCircle = new google.maps.Circle({
                        strokeColor: '#00ffff',
                        strokeOpacity: 0.0,
                        strokeWeight: 2,
                        fillColor: '#00ffff',
                        fillOpacity: 0.20,
                        map: map,
                        center: station_flattened[station],
                        radius: citymap[station].count / 2
                    });
                }
            }
            
            function renderCrashS(){
                //Crash data
                var pCrashLayer = new google.maps.KmlLayer({
                    url: 'https://raw.githubusercontent.com/TheGuy191919/Boston-Traffic-Visualization/master/Data/HSIP_Pedestrian_Crash_Clusters.kml',
                    map: map
                });
                var bCrashLayer = new google.maps.KmlLayer({
                    url: 'https://raw.githubusercontent.com/TheGuy191919/Boston-Traffic-Visualization/master/Data/HSIP_Bicycle_Crash_Clusters.kml',
                    map: map
                });
                var cCrashLayer = new google.maps.KmlLayer({
                    url: 'https://raw.githubusercontent.com/TheGuy191919/Boston-Traffic-Visualization/master/Data/HSIP_Crash_Clusters.kml',
                    map: map
                });
            }
            
            function renderWaze(filename, color){
                $.get(filename, function(d){
                    var data = JSON.parse(CSV2JSON(d));
                    for(var p in data){
                        var cityCircle = new google.maps.Circle({
                        strokeColor: color,
                        strokeOpacity: 0.35,
                        strokeWeight: 2,
                        fillColor: color,
                        fillOpacity: 0.3,
                        map: map,
                        center: {lat: +data[p].locy, lng: +data[p].locx},
                        radius: 14
                    });
                    }
                });
            }

            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 14,
                    center: {lat: 42.35859547437996, lng: -71.07286921502686},
                    clickableIcons: false
                });
                
                renderTraffic();
                renderCrashS();
                renderWaze("Data/Accidents.csv", "#ff0000");
                renderWaze("Data/General_Hazard.csv", "#00ff00");
                renderWaze("Data/Pot_holes.csv", "#0000ff");
                renderWaze("Data/Road_closed_event.csv", "#ff8000");
                renderWaze("Data/Road_construction.csv", "#ffff00");
            }


        </script>
    </body>
</html><!--
<html>
    <head>
        <title>Boston Traffi                                                                                                                                                                                                                                                                                                                                                                                                                    c Visulization</title>
        <script src="https://code.jquery.com/jquery-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                2.1.4.min.js"></script>
        <script src="csvhelper.js" type="text/javascript"></script>
        <script>                                                                                                                                                                                                                                                                                                                                                                                
            $.getScript("key.js", function(){
                $.getScript("https://maps.google.com/maps/api/js?sensor=false&libraries=geometry&v=3.22&key=" + GOOGLE_API_KEY);
            });
        </script>
        <script src="maplace.min.js" type="text/javascript"></script>
        <script src="papaparse.min.js" type="text/javascript"></script>
        <script src="script.js" type="text/javascript"></script>
    </head>
<<<<<<< HEAD
    <body>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        <h1>Bostonography</h1>
        <div id="gmap" style="width:100%;height:90%;"></div>
    </body>
</html>-->
